<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <title>Bate-papo Node.js e Socket.IO</title>

    <style>
      /* Centraliza tudo no meio da tela e adiciona o fundo no estilo Roblox */
      body {
        background: linear-gradient(to bottom, #66a7ff 0%, #9fd6ff 60%, #b7e1ff 100%);
        font-family: Arial, sans-serif;
        margin: 0;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      /* Caixa geral do chat */
      .fieldgeral{
        padding: 20px;
        background-color: rgba(30, 30, 30, 0.85);
        border: none;
        border-radius: 15px;
        width: 600px;          
        max-height: 500px;      /* Limita a altura */
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        box-shadow: 0 0 15px rgba(0,0,0,0.4);
      }

      /* Área onde ficam as mensagens */
      .fieldmsg{
        background-color: rgba(50, 50, 50, 0.8);
        border-radius: 10px;
        padding: 10px;
        overflow-y: auto;
        flex: 1;
      }

      /* Área dos inputs (parte de baixo) */
      .fieldinputs{
        background-color: rgba(20, 20, 20, 0.9);
        border-radius: 10px;
        padding: 8px;
        display: flex;
        gap: 5px;
        align-items: center;
      }

      ul{
        background-color: rgba(104, 104, 104, 0.15);
        color: white;
        text-shadow:
        -1px -1px 0 black,
        1px -1px 0 black,
        -1px  1px 0 black,
        1px  1px 0 black;
        list-style: none;
        padding: 0;
        margin: 0;
        font-size: 14px;
        overflow-y: auto;
      }

      .nome-usuario {
        font-size: 15px;
        font-weight: bold;
        text-shadow:
        -1px -1px 0 black,
        1px -1px 0 black,
        -1px  1px 0 black,
        1px  1px 0 black;
      }

      input{
        background-color: rgba(95, 95, 95, 0.74);
        color: white;
        text-shadow:
        -1px -1px 0 black,
        1px -1px 0 black,
        -1px  1px 0 black,
        1px  1px 0 black;
        border: none;
        height: 28px;
        padding: 5px;
        border-radius: 6px;
        flex: 1;
        font-size: 13px;
      }

      input::placeholder{
        color: rgb(255, 255, 255);
        text-shadow:
        -1px -1px 0 black,
        1px -1px 0 black,
        -1px  1px 0 black,
        1px  1px 0 black;
      }

      button {
        background-color: #007bff;
        border: none;
        border-radius: 6px;
        color: white;
        padding: 6px 12px;
        cursor: pointer;
        font-weight: bold;
      }

      button:hover {
        background-color: #339cff;
      }
    </style>

  </head>
  <body>
    <fieldset class="fieldgeral">
      <fieldset class="fieldmsg">
        <input id="nome" placeholder="Seu nome de usuário" autocomplete="off" /><br>
        <ul id="mensagens"></ul>
      </fieldset>
      <form>
        <fieldset class="fieldinputs">
          <input id="mensagem" placeholder="Sua mensagem" autocomplete="off" />
          <button>Enviar</button>
        </fieldset>
      </form>
    </fieldset>
  
    <!-- Importa o script do Socket.IO -->
    <script src="/socket.io/socket.io.js"></script>
    <script>

      // Lista de palavras ofensivas que serão censuradas
const palavrasProibidas = [
  "porra", "caralho", "merda", "buceta", "foda", "puta", "puto",
  "arrombado", "corno", "viado", "desgraça", "cacete"
];

// Função que censura palavras ofensivas
function censurar(texto) {
  let censurado = texto;
  palavrasProibidas.forEach(palavra => {
    const regex = new RegExp(`\\b${palavra}\\b`, "gi");
    // substitui a palavra por a primeira letra + ***
    censurado = censurado.replace(regex, palavra[0] + "***");
  });
  return censurado;
}
      
      // Cria uma instância do Socket.IO
      const socket = io();
      // Seleciona o input do nome do usuário
      const nomeInput = document.getElementById('nome');
      // Seleciona o input da mensagem
      const mensagemInput = document.getElementById('mensagem');
      // Seleciona a lista de mensagens
      const mensagens = document.getElementById('mensagens');

      // Objeto que guarda a cor de cada usuário
      const coresUsuarios = {};

      // Função para gerar uma cor baseada no nome do usuário
      function gerarCor(nome) {
        let hash = 0;
        for (let i = 0; i < nome.length; i++) {
          hash = nome.charCodeAt(i) + ((hash << 5) - hash);
        }
        const cor = Math.abs(hash % 360);
        return `hsl(${cor}, 80%, 60%)`; // cores vivas e variadas
      }

      // Adiciona um evento de escuta para o envio do formulário
      document.querySelector('form').addEventListener('submit', event => {
        // Previne o envio padrão do formulário
        event.preventDefault();
        // Obtém o valor do input do nome do usuário
        const nome = nomeInput.value;
        // Obtém o valor do input da mensagem
        const mensagem = mensagemInput.value;
        // Verifica se ambos os campos foram preenchidos antes de enviar a mensagem
        // Verifica se os valores são válidos (não estão em branco)
        //trim() é um método da linguagem JavaScript que remove os espaços em branco do início e do final de uma string.
        // emit envia um evento chamado "chat message" com um objeto contendo os valores de nome e mensagem para o servidor.
        nome.trim() && mensagem.trim() && socket.emit('chat message', { nome, mensagem });
        // Limpa o input da mensagem
        mensagemInput.value = '';
        // Desabilita o input do nome do usuário após a primeira mensagem
        nomeInput.disabled = true; 
      });

      // Adiciona um evento de escuta para o evento de mensagem recebido do servidor
      socket.on('chat message', dados => {
        // Cria uma cor única se o usuário ainda não tiver uma
        if (!coresUsuarios[dados.nome]) {
          coresUsuarios[dados.nome] = gerarCor(dados.nome);
        }

        // Cria um elemento de lista para exibir a mensagem
        const lista = document.createElement('li');
        // Cria o elemento para o nome do usuário e aplica a classe
        const nomeSpan = document.createElement('span');
        nomeSpan.classList.add('nome-usuario');
        nomeSpan.textContent = `${dados.nome}: `;
        nomeSpan.style.color = coresUsuarios[dados.nome];
        
        // Cria o elemento para a mensagem
        const mensagemSpan = document.createElement('span');
        mensagemSpan.textContent = dados.mensagem;

        // Adiciona o nome e a mensagem ao item da lista
        lista.appendChild(nomeSpan);
        lista.appendChild(mensagemSpan);

        // Adiciona o elemento de lista à lista de mensagens
        mensagens.appendChild(lista);

        // Faz o scroll automático para a última mensagem
        mensagens.scrollTop = mensagens.scrollHeight;
      });
    </script>
  </body>
</html>

